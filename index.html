<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/png" href="./images/favicon.png"/>
    <title>Resources</title>
    <meta name="description" content="Resources for Learning Mentors at Global Learner">
    <link href="node_modules/tabulator-tables/dist/css/tabulator.min.css" rel="stylesheet">
    <style>
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #000000;
            color: white;
            padding: 8px;
            z-index: 100;
        }
        .skip-link:focus {
            top: 0;
        }
    </style>
</head>
<body>
    <a class="skip-link" href="#resources-table">Skip to main</a>
    <main id="resources-table"></main>
    <script type="text/javascript" src="node_modules/tabulator-tables/dist/js/tabulator.min.js"></script>
    <script type="text/javascript"> 
        const getJSON = async url => {
            try {
                const response = await fetch(url);
                if(!response.ok) 
                throw new Error(response.statusText);
                const data = await response.json();
                return data; 
            } catch(error) {
                return error;
            }
        };
        console.log("Fetching data...");
        getJSON('https://script.google.com/macros/s/AKfycbzOJve0jFx_sdsGDE1aOcuDmVyc71onWBWNIjju5z5Pz12U7Aw/exec?id=1veTSMjElb9FcLJlsh0M5ko3iT2eOxkAF_S8JvvyMBMs&sheet=Live').then(JSONdata => {
            console.log(JSONdata);
            var table = new Tabulator("#resources-table", {
                ajaxLoader: false,
                data:JSONdata, 
                layout:"fitColumns",
                resizableColumns:false,
                responsiveLayout:"hide", 
                placeholder: "No Data",
                layoutColumnsOnNewData:true,
                height:"95vh",
                pagination:"local",
                paginationSize:100,
                initialSort:[             
                    {column:"Grade", dir:"asc"},
                ],
                columns:[
                    {title:"Year", field:"Grade", width:69, sorter:"number", headerSort:false},
                    {title:"Subject", field:"Subject", width:174, sorter:"string", headerSort:false},
                    {title:"Topic", field:"Topic", minWidth:231, responsive:0, headerSort:false},
                    {title:"Date Created", field:"Date_Created", width:138, responsive:3, headerSort:false},
                    {title:"File Type", field:"Type", width:105, responsive:2, headerSort:false},
                    {title:"Link", field:"URL", formatter:"link", formatterParams:{label:"Download", target:"_blank", rel:"noreferrer"}, width:85, responsive:0, headerSort:false},
                ],
            });
            window.addEventListener('resize', function(){
                table.redraw();
            });
        console.log("Success.");
        }).catch(error => {
            console.error(error);
        });
    </script>
</body>
</html>

